
&НаКлиенте
Процедура ОбработкаКоманды(ПараметрКоманды, ПараметрыВыполненияКоманды)
	
	Возврат;
	
	#Если МобильноеПриложениеКлиент Тогда
		Если Не СредстваТелефонии.ПоддерживаетсяОтправкаSMS(Ложь) Тогда
			Возврат;
		КонецЕсли;	
	#Иначе
		Возврат;
	#КонецЕсли
	
	Результат = Ложь;
	ОповещениеСканирования = Новый ОписаниеОповещения("ОбработчикСканированияШК", ЭтотОбъект);
	
	#Если МобильноеПриложениеКлиент Тогда
		
		Если СредстваМультимедиа.ПоддерживаетсяСканированиеШтрихКодов() Тогда
			СредстваМультимедиа.ПоказатьСканированиеШтрихКодов(, ОповещениеСканирования,, ТипШтрихКода.Двухмерный);
		Иначе
			СтрШтрихкода = "";
			Если ВвестиСтроку(СтрШтрихкода) Тогда
				Результат = СМСИнформированиеКлиентСервер.ПроверитьШКОтправкиСМС(СтрШтрихкода);
			КонецеСли;	
			
			Если Результат.Корректно Тогда
				ВыполнитьРассылку(Результат.Рейс);
			Иначе
				Сообщить("Некорректные данные ШК!", СтатусСообщения.ОченьВажное);
			КонецеСли;
			
		КонецеСли;
	#Иначе
		СтрШтрихкода = "";
		Если ВвестиСтроку(СтрШтрихкода) Тогда
			Результат = СМСИнформированиеКлиентСервер.ПроверитьШКОтправкиСМС(СтрШтрихкода);
		КонецеСли;	
		
		Если Результат.Корректно Тогда
			ВыполнитьРассылку(Результат.Рейс);
		Иначе
			Сообщить("Некорректные данные ШК!", СтатусСообщения.ОченьВажное);
		КонецеСли;
		
	#КонецЕсли
	

КонецПроцедуры

&НаКлиенте
Процедура ОбработчикСканированияШК(Штрихкод, Результат, Сообщение, ДополнительныеПараметры) Экспорт
	//СМСИнформированиеКлиент.ПроверитьШКОтправитьСМС(Штрихкод);
	#Если МобильноеПриложениеКлиент Тогда
		СредстваМультимедиа.ЗакрытьСканированиеШтрихКодов();
	#КонецеСли
	Результат = ПроверкаШКНаСервере(Штрихкод);
	Если Результат.Корректно Тогда
		ВыполнитьРассылку(Результат.Рейс);
	Иначе
		Сообщить("Некорректные данные ШК!", СтатусСообщения.ОченьВажное);
	КонецеСли;	
КонецПроцедуры

&НаСервере
Функция ПроверкаШКНаСервере(Штрихкод)
	Возврат СМСИнформированиеКлиентСервер.ПроверитьШКОтправкиСМС(Штрихкод);
КонецФункции	

&НаКлиенте
Процедура ВыполнитьРассылку(Рейс)
	//Сообщить("Получение набора данных");
	НаборДанных = ПолучитьНаборДанныхНаСервере(Рейс);
	//Сообщить("Старт отправки");
	СМСИнформированиеКлиентСервер.ОтправитьСМСПоРейсуПоНаборуДанных(Рейс, НаборДанных);	
КонецПроцедуры	

&НаСервере
Функция ПолучитьНаборДанныхНаСервере(Рейс)
	Возврат СМСИнформированиеКлиентСервер.СформироватьНаборДанныхДляОтправкиСМС(Рейс);	
КонецФункции	
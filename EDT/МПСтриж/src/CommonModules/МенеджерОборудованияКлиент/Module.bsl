
// Устанавить драйвер из макета
//
Функция УстановитьДрайверИзМакета(ИдентификаторДрайвера) Экспорт
	
	Результат = Ложь;
	
	ДанныеДрайверов = МенеджерОборудованияВызовСервера.ПолучитьДанныеДрайвера(ИдентификаторДрайвера);
	
	Если ДанныеДрайверов.Количество() > 0 Тогда
		
		ДанныеДрайвера = ДанныеДрайверов[0];
		
		Если Не ДанныеДрайвера.УстановкаИзМакета Тогда
			ТекстОшибки = НСтр("ru='Установка драйвера производиться с помощью дистрибутива поставщика.'");
			Сообщить(ТекстОшибки); 
			Возврат Результат;
		КонецЕсли;
		
		ИмяМакета = ДанныеДрайвера.ИмяПредопределенныхДанных;
		
		Если ДанныеДрайвера.ИнтеграционноеПриложение Тогда
			// Получение макета с сервера
			СсылкаНаФайл = МенеджерОборудованияВызовСервера.ПолучитьМакетДрайвера(ИмяМакета);
			ИмяФайлаВрем = ИмяМакета + ".apk";
			ВременныйКаталог = КаталогВременныхФайлов();
			Если ПолучитьФайл(СсылкаНаФайл, ВременныйКаталог + ИмяФайлаВрем, Ложь) Тогда
				ЗапуститьПриложение(ВременныйКаталог + ИмяФайлаВрем, , Истина);
				Результат = Истина;
			Иначе
				ТекстОшибки = НСтр("ru='Ошибка установки драйвера.'");
				Сообщить(ТекстОшибки); 
			КонецЕсли;
		Иначе
			УстановитьВнешнююКомпоненту ("ОбщийМакет." + ИмяМакета);
			Сообщить(НСтр("ru='Внешняя компонента установлена.'"));
		КонецЕсли;
		
	КонецЕсли;
	
	Возврат Результат;
	
КонецФункции


// Устанавить драйвер из макета
//
Функция УстановитьДрайверИзМакетаСтриж(ИмяМакета) Экспорт
	
	Результат = Ложь;
	
	
	// Получение макета с сервера
	СсылкаНаФайл = МенеджерОборудованияВызовСервера.ПолучитьМакетДрайвера(ИмяМакета);
	ИмяФайлаВрем = ИмяМакета + ".apk";
	ВременныйКаталог = КаталогВременныхФайлов();
	Если ПолучитьФайл(СсылкаНаФайл, ВременныйКаталог + ИмяФайлаВрем, Ложь) Тогда
		Попытка
			ЗапуститьПриложение(ВременныйКаталог + ИмяФайлаВрем, , Ложь);
		Исключение
			ТО = ОписаниеОшибки();
			Сообщить(ТО); 
		КонецПопытки;	
		Результат = Истина;
	Иначе
		ТекстОшибки = НСтр("ru='Ошибка установки драйвера.'");
		Сообщить(ТекстОшибки); 
	КонецЕсли;
	
	
	Возврат Результат;
	
КонецФункции

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"><html><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"></meta><link rel="stylesheet" type="text/css" href="v8help://service_book/service_style"></link><meta name="GENERATOR" content="MSHTML 11.00.10570.1001"></meta></head><body>
<blockquote style="MARGIN-RIGHT: 0px" dir="ltr">
<h1>Обработка "Просмотр логов технологического журнала".</h1>
<p align="justify">   Основное назначение обработки - это возможность простого просмотра и анализа логов <br>технологического журнала. Дополнительно к этому обработка содержит механизм, позволяющий <br>включить/отключить процесс создания технологического журнала  на сервере 1С предприятия или <br>в файловой БД, а затем, получить файл логов с сервера и произвести анализ полученных результатов. <br>   Работа обработки поддерживается только в режиме управляемого приложения.<br>   Применять обработку лучше для анализа небольших объемов информации. Рекомендуется ее использовать <br>в режиме включил на 5-30 минут, отключил, получил файл и проанализировал.<br>   Также, рекомендуется производить более тонкую настройку конфигурационного файла для получения <br>минимального количества нужных сведений.</p>
<h2 align="left">Просмотр логов.</h2>
<p dir="ltr">   Файлы логов можно просматривать уже готовые, полученные любым доступным способом.<br>Обычно это файл с расширением <strong>"log"</strong>. Файл для просмотра выбирается в поле, напротив переключателей<br><strong>"Из указанного файла"</strong>. <br>Затем нужно нажать кнопку <strong>"Показать журнал"</strong>, после чего, появляется список всех строк выбранного файла <br>в табличной части обработки.<br>   В правой части окна,  отображается исходный текст текущей выделенной строки. Отображается он как есть, <br>без форматирования. Кнопкой <strong>"Форматированный просмотр"</strong> можно переключить отображение текста в <br>форматированном виде. Также, если не устраивает размер шрифта, его размер можно изменить через<br>контекстное меню текстового поля просмотра - пункт <strong>"Задать размер шрифта"</strong>.<br>   Нажатием на кнопку <strong>"В отдельном окне"</strong> открывается отдельное окно просмотра текущего запроса или <br>текста выбранной строки, уже в форматированном виде и с цветовым выделением ключевых фраз.<br>Для каждой строки можно открыть отдельное окно. Это же окно открывается двойным нажатием на текущей <br>строке в табличной части.<br>   Можно, перед тем как нажать кнопку <strong>"Показать журнал"</strong> установить сразу условия отбора строк. Для <br>этого следует  заполнить поле <strong>"Содержит"</strong> ключевыми фразами, разделенными пробелами, установить <br>переключатели <strong>"ИЛИ"</strong> или <strong>"И"</strong>,  установить (или не устанавливать вовсе) галку <strong>"НЕ"</strong>, и нажать на кнопку <br><strong>"Применить отбор"</strong> или <strong>"Показать журнал"</strong>. <br>Если выбран переключатель <strong>"ИЛИ"</strong>, то отбираются те строки, в которых присутствует любая фраза, из тех <br>что задана. Если задана <strong>"И"</strong> , то будут отбираться строки где встречаются все заданные фразы. Галка <strong>"НЕ"</strong> <br>инвертирует условия поиска. <br>Галка <strong>"В терм.СУБД"</strong> задает режим поиска объектов по имени СУБД. Например, мы хотим найти объект, <br>который в 1С  называется "Контрагенты". При поиске, программа найдет, какие таблички СУБД могут <br>соответствовать искомому - например, это оказались три объекта с именами СУБД "Reference145",<br>"ReferenceChngR1369" и "RefSInf29593". И далее отбор будет производиться с поиском уже любого из<br>этих трех имен. Такой отбор уже будет работать только по "ИЛИ". <br>   Поля <strong>"Показать" "первые/последние"</strong> N <strong>записей</strong> позволяют задать ограничение количества строк <br>отбираемых и отображаемых в табличной части. По умолчанию отбирается и отображается в списке <br>не более 10000 строк.  Поле <strong>"первые/последние"</strong> задает режим выборки строк либо с начала <br>анализируемого log-файла, либо с конца. Это может быть полезным при анализе больших файлов логов,<br>когда, например, требуется анализировать, например, только  последние 5000 строк файла логов,<br>в живую, так сказать, при включенном технологическом журнале (см.ниже). <br>Значение количества записей необходимо выставлять в разумных пределах - чем больше значение, тем <br>медленнее будет происходить разбор файла.<br>   Дополнительно, полями <strong>"Интервал времени от .. до"</strong> можно задать ограничения по времени создания<br>записей, в формате "мм:сс.доли секунд", например 55:23.156456. Заполнить можно как оба поля сразу, так <br>и какое-нибудь одно. Если будет заполнено первое поле, то в отбор попадут все строки равные или больше <br>указанного значения. Если будет заполнено только второе поле, то в отбор попадут записи с временем создания<br>меньше или равным заданному. </p>
<h1> Механизм создания файлов логов технологического журнала.</h1>
<p>   В обработке реализован механизм создания файлов логов технологического журнала. Если нет других<br>способов получения такого файла, то этот режим для этого и создан. <br>   У платформы 1С существует возможность получения файлов логов путем помещения специального <br>конфигурационного файла настроек технологического журнала либо в общий каталог CONF всех версий либо в <br>каталог "CONF" конкретной версии программы. Как только этот файл появляется в указанном месте, программа <br>начинает процесс записи файла логов, согласно настроек файла настройки технологического журнала. <br>Подробнее почитать можно в <a href="http://its.1c.ru/db/v837doc#bookmark:adm:TI000000441">документации</a> -<strong>"Глава 6. Администрирование информационной базы, <br>6.14. Технологический журнал"</strong>.<br>   В обработке, в макете, зашит внутри шаблон конфигурационного файла настроек технологического журнала. <br>Он используется, если выбран переключатель <strong>"Сформировать со стандартными настройками"</strong>.  <br>Стандартные настройки подразумевают регистрацию планов запросов, самих запросов для всех версий <br>СУБД SQL и для файловой версии в том числе. Также регистрируются исключительные ситуации приложения 1с, <br>ошибки запросов, события, начались, но не закончились в момент возникновения нештатной ситуации.<br>    Можно создать свой, пользовательский конфигурационный файл и уже его использовать для получения <br>логов. Для создания таких файлов существует замечательная обработка "<a href="http://its.1c.ru/db/metod8dev/content/3474/hdoc">Настройка технологического журнала</a>". <br>Ее также можно найти на диске ИТС. Она позволяет произвести наглядно любые настройки технологического журнала.<br>Полученный с ее помощью конфигурационный файл можно использовать для получения логов технологического<br>журнала - нужно лишь указать данный файл в поле напротив переключателя <strong>"Сформировать с указанными <br>настройками"</strong>.<br>   Собственно сам процесс создания технологического журнала запускается по кнопке <strong>"Запустить технологический <br>журнал"</strong>.Когда процесс запущен, надпись на кнопке меняется на <strong>"Остановить технологический журнал"</strong>. <br>Соответственно, повторное нажатие нажатие останавливает процесс получения лога. При запуске процесса, на <br>сервер 1С предприятия передается либо стандартный файл настроек либо указанный пользователем и сохраняется <br>в общей подпапке <strong>"CONF"</strong> каталога, куда была была произведена установка платформы 1С. Для файловой БД - это <br>просто локальная папка установки платформы. Если в этой папке был какой-либо другой конфигурационный файл, <br>он переименовывается на время создания технологического журнала в файл с расширением *.off. По окончании <br>создания технологического журнала, конфигурационный файл удаляется, старый файл, если был, возвращается назад. <br>   При работе с обработкой, следует учитывать следующее: при закрытии обработки не происходит автоматического <br>останова создания технологического журнала. Пока не будет нажата кнопка остановки соpдания журнала, или пока не будет <br>убран конфигурационный файл из папки "CONF", в файл логов будет вестись непрерывно запись данных. Данная <br>возможность полезна будет в тех случаях, когда нужно отследить события, связанные с подключением или отключением <br>сеансов,запросы к hasp-ключам, т.е. все что требует завершения или начала сеанса.<br>   Кнопка <strong>"Получить и показать"</strong> служит для получения файла логов с сервера. При нажатии на кнопку, происходит <br>запускает процесс архивирования файла логов в zip, передача его на клиента, сохранение его в папку локального<br>компьютера, запускается сразу его разбор на строки и загрузка в табличную часть. Папка для сохранения свежего <br>файла логов берется из поля напротив переключателя <strong>"Из указанного файла"</strong>.  Меняется только имя файла.<br>Получение файла логов можно производить на горячую или в живую, т.е. прямо во время включенного режима создания <br>технологического журнала. Следует учитывать тот факт, что при определенных настройках и в зависимости от загрузки <br>сервера запись в лог-файл происходит не мгновенно, а по истечении какого-то времени.<br>   Поля "<strong>Идентификатор процесса ОС</strong>" и "<strong>Каталог с лог файлами на сервере</strong>" просто отображают ID процесса <br>сервера 1С в котором запущен текущий сеанс и в каком каталоге находится создаваемый файл логов технологического <br>журнала на сервере.     </p>
<h2>Просмотр запросов/текстов логов в отдельном окне.</h2>
<p>   В данном окне отображается запрос или текст строки, полученный из технологического журнала. При открытии<br>производится небольшое форматирование текста для удобства его просмотра и дальнейшего анализа. После каждой <br>запятой добавляются переносы строк, выделяются цветом ключевые фразы запросов.<br>   Кнопками <strong>"В терминах СУБД"</strong> и <strong>"Имена объектов метаданных"</strong> можно управлять отображением именами <br>объектов и им принадлежащих полей:</p>
<blockquote style="MARGIN-RIGHT: 0px" dir="ltr">
<p>"<strong>В терминах СУБД</strong>" - получение текста строки в исходном виде, как есть- как они заданы в SQL;</p>
<p> "<strong>Имена объектов метаданных</strong>" - замена в тексте SQL имен объектов, полей типа <br>"FROM Reference53 Q_000_T_001" и "<font size="1">Q_000_T_001.Fld877" </font><font size="1">на </font><font size="1">1С имена - <br>"FROM Справочник.Номенклатура Q_000_T_001" и "Q_000_T_001.Комментарий";</font></p>
<p dir="ltr">"С<strong>труктура хранения БД</strong>" - формирование для просмотра дерева всех объектов конфигурации <br>с соответствующими  именами в SQL и 1С. Допустим надо найти, под каким именем в SQL сидит справочник<br>"Склады". Сия возможность в этом и поможет.</p></blockquote>
<p> </p></blockquote></body></html>

Процедура ОбработкаПроведения(Отказ, РежимПроведения)
	
	// РН УчетПоездокМагистрали
	Движения.УчетПоездокМагистрали.Записывать = Истина;
	Движения.УчетПоездокМагистрали.Очистить();
	
	Движение = Движения.УчетПоездокМагистрали.Добавить();
	Движение.Период = Дата;
	Движение.Регистратор = ЭтотОбъект.Ссылка;
	Движение.РегионОтправления = РегионОтправления;
	Движение.РегионПрибытия = РегионПрибытия;
	Движение.Транспорт = Транспорт;
	Движение.Водитель = Водитель;
	
	Движение.ПоездкаВыполнена = 0;
	Движение.ПоездкаСорвана = 0;	
	Если ЭтотОбъект.РезультатПоездки = Перечисления.РезультатыПоездкиМагистрали.Выполнена Тогда	
		Движение.ПоездкаВыполнена = 1;
	ИначеЕсли ЭтотОбъект.РезультатПоездки = Перечисления.РезультатыПоездкиМагистрали.Сорвана Тогда	
		Движение.ПоездкаСорвана = 1;	
	КонецЕсли;
	
	
	
	// РН СводПоЗарплате
	Движения.СводПоЗарплате.Записывать = Истина;
	Движения.СводПоЗарплате.Очистить();
	
	Если ЭтотОбъект.РезультатПоездки = Перечисления.РезультатыПоездкиМагистрали.Выполнена Тогда
		
		Движение = Движения.СводПоЗарплате.Добавить();
		Движение.Период = Дата;	
		Движение.Регистратор = ЭтотОбъект.Ссылка;
		Движение.ПоказательКоличества = 1;
		Движение.Сумма = Тариф;
		Движение.Регион = РегионПрибытия;
		Движение.УчастникЭкипажа = Перечисления.УчастникЭкипажа.Водитель;
		Движение.ФизЛицо = Водитель;
		Движение.ТипРасчетаЗарплаты = Перечисления.ТипыРасчетаЗарплаты.Магистраль;
		//Движение.ЮрЛицо = ;
		Движение.ТипНУ = Перечисления.ТипыНУЭкипажей.Начисление;
		Движение.Услуга = Справочники.ПоказателиРасчетаУслугСД.ОсновнаяЧасть;
	
	КонецЕсли;
	
	// Миго-групп ШушлебинДА {
	// 05.06.2017 движения по регистру мгУчетЗарплаты
	Движения.мгЗарплатаНачисления.Записывать = Истина;
	Движения.мгЗарплатаНачисления.Очистить();
	Если ЭтотОбъект.РезультатПоездки = ПредопределенноеЗначение("Перечисление.РезультатыПоездкиМагистрали.Выполнена") Тогда
		Движение = Движения.мгЗарплатаНачисления.Добавить();
		Движение.ВидДвижения = ВидДвиженияНакопления.Приход;
		//Движение.Период = ДатаОкончанияПоездки;
		Движение.Период = Дата;
		Движение.Организация = мгОрганизация;
		Движение.Терминал = РегионОтправления;
		Движение.ВидНачисления = ПредопределенноеЗначение("Справочник.мгНачисленияУдержания.МагистральСПБ");
		Движение.Сотрудник = Водитель;
		Движение.Тариф = Тариф;
	КонецЕсли;
	//} ШушлебинДА
		
КонецПроцедуры


Процедура ОбработкаПроведения(Отказ, Режим)
    ДвиженияРасчетМотивацииЭкипажей();
    ДвиженияСводПоЗарплате();
КонецПроцедуры


Процедура ДвиженияРасчетМотивацииЭкипажей()
    Движения.РасчетМотивацииЭкипажей.БлокироватьДляИзменения = Истина;
    Движения.РасчетМотивацииЭкипажей.Записать();
    
    Для Каждого ТекСтрокаНачисленияУдержания Из НачисленияУдержания Цикл
        Если ТекСтрокаНачисленияУдержания.Результат <> 0 Тогда
            Движение = Движения.РасчетМотивацииЭкипажей.Добавить();
            Движение.Период = МесяцРасчета;
            Движение.ФизЛицо = ТекСтрокаНачисленияУдержания.ФизЛицо;
            Движение.УчастникЭкипажа = ТекСтрокаНачисленияУдержания.УчастникЭкипажа;
            Движение.СтатьяНУ = ТекСтрокаНачисленияУдержания.СтатьяНУ;
            Движение.ТипНУ = ТекСтрокаНачисленияУдержания.ТипНУ;
            Движение.Результат = ТекСтрокаНачисленияУдержания.Результат;
            Движение.ТипРасчета = ТекСтрокаНачисленияУдержания.ТипРасчета;
            Движение.ПоказательРасчета = ТекСтрокаНачисленияУдержания.ПоказательРасчета;
            Движение.БазаДляРасчета = ТекСтрокаНачисленияУдержания.БазаДляРасчета;
        КонецЕсли;
    КонецЦикла;
    
    Движения.РасчетМотивацииЭкипажей.БлокироватьДляИзменения = Истина;
    Движения.РасчетМотивацииЭкипажей.Записать();
    
КонецПроцедуры


Процедура ДвиженияСводПоЗарплате()
    Движения.СводПоЗарплате.БлокироватьДляИзменения = Истина;
    Движения.СводПоЗарплате.Записать();
    
    //ВТ_ТаблицаДвижений = НачисленияУдержания.Выгрузить();
    //ВТ_ТаблицаДвижений.Свернуть("ФизЛицо,УчастникЭкипажа,ТипНУ","Результат");
    
    Для Каждого ТекСтрока Из НачисленияУдержания Цикл
        Если ТекСтрока.Результат <> 0 Тогда
            Движение = Движения.СводПоЗарплате.Добавить();
            Движение.Период = МесяцРасчета;
            Движение.ЮрЛицо = Справочники.Организации.ПустаяСсылка();
            Движение.ТипРасчетаЗарплаты = Перечисления.ТипыРасчетаЗарплаты.СдельныйРасчетПоДоставкам;
            Движение.УчастникЭкипажа = ТекСтрока.УчастникЭкипажа;
            Движение.ФизЛицо = ТекСтрока.ФизЛицо;
            Движение.ТипНУ = ТекСтрока.ТипНУ;
            Движение.Сумма = ТекСтрока.Результат;
            Движение.ПоказательКоличества = 1;
        КонецЕсли;
    КонецЦикла;
    
    Движения.СводПоЗарплате.БлокироватьДляИзменения = Истина;
    Движения.СводПоЗарплате.Записать();
    
КонецПроцедуры

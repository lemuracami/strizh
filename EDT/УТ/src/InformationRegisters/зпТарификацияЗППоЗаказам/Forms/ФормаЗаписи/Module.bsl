
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ЗаполнитьВозможныеТипыЗаказов();
	ЗаполнитьКатегорииЗаказов();
	ЗаполнитьЗоныДоставки();
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьВозможныеТипыЗаказов()
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ВложенныйЗапрос.ТипЗаказа КАК ТипЗаказа
	|ИЗ
	|	(ВЫБРАТЬ
	|		зпСхемыРасчетаЗПСхемыКатегорийЗаказов.ТипЗаказа КАК ТипЗаказа
	|	ИЗ
	|		Справочник.зпСхемыРасчетаЗП.СхемыКатегорийЗаказов КАК зпСхемыРасчетаЗПСхемыКатегорийЗаказов
	|	ГДЕ
	|		зпСхемыРасчетаЗПСхемыКатегорийЗаказов.Ссылка = &СхемаРасчетаЗП
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		зпСхемыРасчетаЗПСхемыЗонДоставки.ТипЗаказа
	|	ИЗ
	|		Справочник.зпСхемыРасчетаЗП.СхемыЗонДоставки КАК зпСхемыРасчетаЗПСхемыЗонДоставки
	|	ГДЕ
	|		зпСхемыРасчетаЗПСхемыЗонДоставки.Ссылка = &СхемаРасчетаЗП) КАК ВложенныйЗапрос";
	
	Запрос.УстановитьПараметр("СхемаРасчетаЗП", 			Запись.СхемаРасчетаЗП);
	Запрос.УстановитьПараметр("ТаблСхемыКатегорийЗаказов", 	Запись.СхемаРасчетаЗП.СхемыКатегорийЗаказов.ВыгрузитьКолонку("СхемаКатегорий"));
	Запрос.УстановитьПараметр("ТаблСхемыЗонДоставки", 		Запись.СхемаРасчетаЗП.СхемыЗонДоставки.ВыгрузитьКолонку("СхемаЗон"));
	
	Элементы.ТипЗаказа.СписокВыбора.ЗагрузитьЗначения(Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("ТипЗаказа"));
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьКатегорииЗаказов()
	
	Элементы.КатегорияЗаказа.СписокВыбора.Очистить();
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	зпКатегорииЗаказов.Ссылка КАК КатегорияЗаказа
	|ИЗ
	|	Справочник.зпКатегорииЗаказов КАК зпКатегорииЗаказов
	|ГДЕ
	|	зпКатегорииЗаказов.Владелец В (&ТаблСхемыКатегорийЗаказов)
	|	И зпКатегорииЗаказов.Владелец.ТипЗаказа = &ТипЗаказа";
	
	Запрос.УстановитьПараметр("ТаблСхемыКатегорийЗаказов", 	Запись.СхемаРасчетаЗП.СхемыКатегорийЗаказов.ВыгрузитьКолонку("СхемаКатегорий"));
	Запрос.УстановитьПараметр("ТипЗаказа", Запись.ТипЗаказа);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ТаблКатегорииЗаказов = РезультатЗапроса.Выгрузить();
	Для Каждого строкаТабл Из ТаблКатегорииЗаказов Цикл 
		Элементы.КатегорияЗаказа.СписокВыбора.Добавить(строкаТабл.КатегорияЗаказа);
	КонецЦикла;
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьЗоныДоставки()
	
	Элементы.ЗонаДоставки.СписокВыбора.Очистить();
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	зпЗоныДоставки.Ссылка КАК ЗонаДоставки
	|ИЗ
	|	Справочник.зпЗоныДоставки КАК зпЗоныДоставки
	|ГДЕ
	|	зпЗоныДоставки.Владелец В(&ТаблСхемыЗонДоставки)
	|	И зпЗоныДоставки.Владелец.ТипЗаказа = &ТипЗаказа";
	
	Запрос.УстановитьПараметр("ТаблСхемыЗонДоставки", Запись.СхемаРасчетаЗП.СхемыЗонДоставки.ВыгрузитьКолонку("СхемаЗон"));
	Запрос.УстановитьПараметр("ТипЗаказа", Запись.ТипЗаказа);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ТаблЗоныДоставки = РезультатЗапроса.Выгрузить();
	Для Каждого строкаТабл Из ТаблЗоныДоставки Цикл 
		Элементы.ЗонаДоставки.СписокВыбора.Добавить(строкаТабл.ЗонаДоставки);
	КонецЦикла;
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьВозможныеОсновныеНачисления()
	
	Элементы.ЗонаДоставки.СписокВыбора.Очистить();
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	зпНачисления.Ссылка КАК Нач
	|ИЗ
	|	Справочник.зпНачисления КАК зпНачисления
	|ГДЕ
	|	зпНачисления.ВидНачисления = ЗНАЧЕНИЕ(Перечисление.зпВидыНачислений.ОсновноеНачисление)";
	
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыбН = РезультатЗапроса.Выбрать();
	Пока ВыбН.Следующий() Цикл
		Элементы.ОсновноеНачисление.СписокВыбора.Добавить(ВыбН.Нач);
	КонецЦикла;
	
КонецПроцедуры


&НаКлиенте
Процедура ТипЗаказаПриИзменении(Элемент)
	ЗаполнитьКатегорииЗаказов();
	ЗаполнитьЗоныДоставки();
КонецПроцедуры

&НаКлиенте
Процедура ПередЗаписью(Отказ, ПараметрыЗаписи)
	
	ЭтотОбъект.Запись.Должность = ЭтотОбъект.Запись.Роль;
	
КонецПроцедуры


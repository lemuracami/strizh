&НаКлиенте
Перем лРасчетЗП_Оклад;

&НаКлиенте
Перем лРасчетЗП_НеУчаствуетВФот;

&НаКлиенте
Перем лРасчетЗП_ОкладСумма;

&НаКлиенте
Перем лРасчетЗП_ВидТарифаЗП;

//CeHbKA 09.04.2019 #2989
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Объект.Ссылка.Пустая() И Не ЗначениеЗаполнено(Объект.Родитель.ТерминалДоставки) Тогда
		Отказ = Истина;
		Сообщить("Невозможно создание элемента вне группы с заполненным Терминалом");
		Возврат;
	КонецЕсли;
	
	ДатаРождения = Объект.ФизЛицо.ДатаРождения;
	ВозможностьРедактированияНаименования = РольДоступна("РедактированиеНаименованияСотрудников");
	
	Если НЕ Объект.Ссылка.Пустая() Тогда
		
		СтруктураДополнительныхПараметровФизЛицо = РегистрыСведений.ДополнительныеПараметрыФизЛиц.ИнициализироватьДополнительныеПараметры(Объект.ФизЛицо);
		
		ОсновнаяРоль = СтруктураДополнительныхПараметровФизЛицо.ОсновнаяРольСотрудника;
				
	Иначе
		Объект.ФизЛицо	= Неопределено;
		Фамилия			= "";
		Имя				= "";
		Отчество		= "";
		Объект.Наименование = "";	
	КонецЕсли; 	
	//ТолькоПросмотр = Истина;
	
	//Геннадий #4711 18.01.2022 ++
	Если ЗначениеЗаполнено(Объект.ФизЛицо.КодНетМонет) Тогда
		
		КодНетМонет = Объект.ФизЛицо.КодНетМонет; 
		
	КонецЕсли;
	//Геннадий #4711 18.01.2022 --
	
	//Асеев 15.02.2023 (Задача № 4985)>>>
	Если Объект.ФизЛицо.Пустая() Тогда
		Элементы.ГруппаПаспортныеДанные.Доступность = Ложь;
	Иначе
		ПаспортныеДанные = РегистрыСведений.ПаспортныеДанныеФизЛиц.ПолучитьПоследнее(, Новый Структура("ФизЛицо", Объект.ФизЛицо));
		ДокументСерия = ПаспортныеДанные.ДокументСерия;
		ДокументНомер = ПаспортныеДанные.ДокументНомер;
		ДокументДатаВыдачи = ПаспортныеДанные.ДокументДатаВыдачи;
		ДокументКемВыдан = ПаспортныеДанные.ДокументКемВыдан;
		ДокументКодПодразделения = ПаспортныеДанные.ДокументКодПодразделения;
		//Асеев 15.02.2023 (Задача № 4985)<<<
		Запрос = Новый Запрос;
		Запрос.УстановитьПараметр("ФизЛицо", Объект.ФизЛицо);
		Запрос.Текст =
		"ВЫБРАТЬ
		|	ВЗ_ПриемНаРаботу.Период КАК ДатаПриемаНаРаботу
		|ИЗ
		|	(ВЫБРАТЬ ПЕРВЫЕ 1
		|		РаботникиОрганизации.Период КАК Период
		|	ИЗ
		|		РегистрСведений.РаботникиОрганизации КАК РаботникиОрганизации
		|	ГДЕ
		|		РаботникиОрганизации.ФизЛицо = &ФизЛицо
		|	
		|	УПОРЯДОЧИТЬ ПО
		|		Период УБЫВ) КАК ВЗ_МаксПериод
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.РаботникиОрганизации КАК РаботникиОрганизации
		|		ПО ВЗ_МаксПериод.Период = РаботникиОрганизации.Период
		|			И (РаботникиОрганизации.ФизЛицо = &ФизЛицо)
		|			И (РаботникиОрганизации.Состояние = ЗНАЧЕНИЕ(Перечисление.СостояниеРаботникаОрганизации.ПринятНаРаботуВОрганизацию))
		|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ ПЕРВЫЕ 1
		|			РаботникиОрганизации.Период КАК Период
		|		ИЗ
		|			РегистрСведений.РаботникиОрганизации КАК РаботникиОрганизации
		|		ГДЕ
		|			РаботникиОрганизации.ФизЛицо = &ФизЛицо
		|			И РаботникиОрганизации.Регистратор ССЫЛКА Документ.ПриемНаРаботуВОрганизацию
		|		
		|		УПОРЯДОЧИТЬ ПО
		|			Период УБЫВ) КАК ВЗ_ПриемНаРаботу
		|		ПО (ИСТИНА)";
		Выборка = Запрос.Выполнить().Выбрать();
		Если Выборка.Следующий() Тогда
			ДатаПриемаНаРаботу = Выборка.ДатаПриемаНаРаботу;
		КонецЕсли;
	КонецЕсли;
	
	
КонецПроцедуры
//CeHbKA 09.04.2019 #2989


&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	ЗаполнитьРеквизитыРасчетаЗПИзРСМетодикаРасчетаЗП();
	
	ЗаполнитьПромежуточныеЗначения();
	
	//CeHbKA 09.04.2019 #2989
	РаботаСФизЛицамиКлиент.ЗаполнитьФИО(ЭтаФорма);
	//Геннадий 09.06.2020 ->
	РаботаСФизЛицамиКлиент.ЗаполнитьПрочиеПараметры(ЭтаФорма);
	//Геннадий 09.06.2020 <-
	РаботаСФизЛицамиКлиент.ДоступностьНаименованияИФИО(ЭтаФорма);	
	//CeHbKA 09.04.2019 #2989
	
	//ТолькоПросмотр = Истина;
КонецПроцедуры

&НаКлиенте
Процедура ПередЗаписью(Отказ, ПараметрыЗаписи)
	
	//CeHbKA 09.04.2019 #2989
	Если РаботаСФизЛицамиКлиент.ПроверитьЗаполнениеПоляФормы(ЭтаФорма, "Фамилия")
		ИЛИ РаботаСФизЛицамиКлиент.ПроверитьЗаполнениеПоляФормы(ЭтаФорма, "Имя")
		ИЛИ РаботаСФизЛицамиКлиент.ПроверитьЗаполнениеПоляФормы(ЭтаФорма, "ДатаРождения") Тогда
		Отказ = Истина;
	КонецЕсли; 
	
	Если Отказ Тогда
		Возврат;
	КонецЕсли; 
	
	Если Модифицированность ИЛИ Объект.Ссылка.Пустая() Тогда
		
		Если ПроверкаФИО Тогда
			Отказ = РаботаСФизЛицамиКлиент.ПроверитьФИО(ЭтаФорма);
		КонецЕсли; 
		
		Если НЕ Отказ И НЕ ПроверкаФИО Тогда
			
			СтароеФИО = РаботаСФизЛицамиКлиент.НаименованиеФИОВСтруктуру(Объект.ФизЛицо);
			
			//Геннадий 10.06.2020 ->			
			Если РаботаСФизЛицамиКлиент.ФИОНеСовпадает(СтароеФИО, Фамилия, Имя, Отчество) 
				ИЛИ ДРПоменялось ИЛИ НомерТелПоменялся ИЛИ КомментарийПоменялся Тогда
			//Геннадий 10.06.2020 <-
			
				МассивОднофамильцев = ОбработатьНаименованиеИФизЛицо(СтароеФИО);
				
				Если Объект.ФизЛицо.Пустая() Тогда
					Сообщение = Новый СообщениеПользователю;
					Сообщение.Текст = "ВНИМАНИЕ!!! Запись невозможна!"+Символы.ПС+"Физ. лицо с таким ФИО уже существует и привязано к другому экспедитору!";
					Сообщение.Поле = "Наименование";
					Сообщение.Сообщить(); 
					
					Отказ = Истина;
				КонецЕсли;
				
				РаботаСФизЛицамиКлиент.СообщитьОднофамильцев(МассивОднофамильцев);
				
			КонецЕсли;
			
		КонецЕсли; 
		
	КонецЕсли;
	//CeHbKA 09.04.2019 #2989
		
КонецПроцедуры


&НаСервере
Процедура ПослеЗаписиНаСервере(ТекущийОбъект, ПараметрыЗаписи)
	Если МодифицированностьДопПараметров Тогда
		//Марочкин закомментировано 08.12.2023
		//РегистрыСведений.ДополнительныеПараметрыФизЛиц.ДобавлениеИзменениеПараметровФизЛица(Объект.ФизЛицо, ОсновнаяРоль);
		//Марочкин закомментировано 08.12.2023
	КонецЕсли;
	
	//Геннадий #4711 18.01.2022 ++
	Если КодНетМонет <> Объект.ФизЛицо.КодНетМонет Тогда
		
		ФизЛицоОб = Объект.ФизЛицо.ПолучитьОбъект();
		ФизЛицоОб.КодНетМонет = КодНетМонет;
		ФизЛицоОб.Записать();
		Сообщить("Для физ. лица " + Объект.ФизЛицо + " обновлено значение поля ""Код нет монет""");
		
	КонецЕсли;
	//Геннадий #4711 18.01.2022 --

	//Асеев 15.02.2023 (Задача № 4985)>>>
	МодифицированностьПаспортныхДанных = Ложь;
	//Асеев 15.02.2023 (Задача № 4985)<<<
	
КонецПроцедуры


//CeHbKA 09.04.2019 #2989
#Область ИзменениеФИО

&НаКлиенте
Процедура ФИОПриИзменении(Элемент)
	
	РаботаСФизЛицамиКлиент.ФИОПриИзменении(ЭтаФорма);
	
КонецПроцедуры

&НаСервере
Функция ОбработатьНаименованиеИФизЛицо(СтароеФИО) 
	
	//Геннадий 11.06.2020 ->
	//добавлена передача параметров НомерЛичногоТелефона, КомментарийФЛ
	Объект.ФизЛицо = Справочники.ФизическиеЛица.ОбработатьФизЛицо(Объект.ФизЛицо, Объект.Родитель.ТерминалДоставки, Фамилия, Имя, Отчество, ДатаРождения, Тип("СправочникСсылка.новаЭкспедиторы"), НомерЛичногоТелефона, КомментарийФЛ);
	//Геннадий 11.06.2020 <-
	
	Если (НЕ Объект.НаименованиеИзменено) ИЛИ (ПустаяСтрока(Объект.Наименование)) Тогда
		Объект.Наименование = Фамилия + " " + Имя + " " + Отчество;
	КонецЕсли; 

	
	Если НЕ Объект.ФизЛицо.Пустая() Тогда
		
		МассивОднофамильцев = Справочники.ФизическиеЛица.ПроверитьОднофамильцев(Объект.ФизЛицо);
		
		Если (МассивОднофамильцев.Количество() > 0) И (НЕ Объект.НаименованиеИзменено) Тогда
			Объект.Наименование = Фамилия + " " + Имя + " " + Отчество + " (" + Формат(ДатаРождения, "ДЛФ=Д") + ")";
		КонецЕсли;
		
		Возврат МассивОднофамильцев;
		
	КонецЕсли;
	
	МассивОднофамильцев = Новый Массив;
	
	Возврат МассивОднофамильцев; 

КонецФункции // ()

&НаКлиенте
Процедура НаименованиеИзмененоПриИзменении(Элемент)	
	
	РаботаСФизЛицамиКлиент.ДоступностьНаименованияИФИО(ЭтаФорма);
	
	Если НЕ Объект.НаименованиеИзменено Тогда
		РаботаСФизЛицамиКлиент.ЗаполнитьНаименование(ЭтаФорма);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ДатаРожденияОбработкаВыбора(Элемент, ВыбранноеЗначение, СтандартнаяОбработка)
	
	РаботаСФизЛицамиКлиент.ПроверитьСменуДатыРождения(ВыбранноеЗначение, ЭтаФорма);
	
КонецПроцедуры

&НаКлиенте
Процедура ДатаРожденияОкончаниеВводаТекста(Элемент, Текст, ДанныеВыбора, ПараметрыПолученияДанных, СтандартнаяОбработка)
		
	СтандартнаяОбработка = Ложь;
	
	РаботаСФизЛицамиКлиент.ПроверитьСменуДатыРождения(Текст, ЭтаФорма);
	
КонецПроцедуры

#КонецОбласти 
//CeHbKA 09.04.2019 #2989

&НаСервере
Процедура ЗаполнитьРеквизитыРасчетаЗПИзРСМетодикаРасчетаЗП()
	Зап = Новый Запрос;
	Зап.Текст = "ВЫБРАТЬ
	|	МетодикаРасчетаЗППоФизЛицамСрезПоследних.Период КАК Период,
	|	МетодикаРасчетаЗППоФизЛицамСрезПоследних.Оклад КАК Оклад,
	|	МетодикаРасчетаЗППоФизЛицамСрезПоследних.НеУчаствуетВФот КАК НеУчаствуетВФот,
	|	МетодикаРасчетаЗППоФизЛицамСрезПоследних.ОкладСумма КАК ОкладСумма,
	|	МетодикаРасчетаЗППоФизЛицамСрезПоследних.ВидТарифаЗП КАК ВидТарифаЗП
	|ИЗ
	|	РегистрСведений.МетодикаРасчетаЗППоФизЛицам.СрезПоследних КАК МетодикаРасчетаЗППоФизЛицамСрезПоследних
	|ГДЕ
	|	МетодикаРасчетаЗППоФизЛицамСрезПоследних.ФизЛицо = &ФизЛицо";
	Зап.УстановитьПараметр("ФизЛицо", Объект.Ссылка);
	
	Выб = Зап.Выполнить().Выбрать();
	
	Пока Выб.Следующий() Цикл
		РасчетЗП_ДатаСведений = Выб.Период;
		РасчетЗП_Оклад = Выб.Оклад;
		РасчетЗП_НеУчаствуетВФот = Выб.НеУчаствуетВФот;
		РасчетЗП_ОкладСумма = Выб.ОкладСумма;
		РасчетЗП_ВидТарифаЗП = Выб.ВидТарифаЗП;
	КонецЦикла;	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьПромежуточныеЗначения()
	лРасчетЗП_Оклад = РасчетЗП_Оклад;
	лРасчетЗП_НеУчаствуетВФот = РасчетЗП_НеУчаствуетВФот;
	лРасчетЗП_ОкладСумма = РасчетЗП_ОкладСумма;
	лРасчетЗП_ВидТарифаЗП = РасчетЗП_ВидТарифаЗП;
КонецПроцедуры	


&НаКлиенте
Процедура РасчетЗП_НеУчаствуетВФотПриИзменении(Элемент)
	УправлениеДиалогом();
КонецПроцедуры

&НаКлиенте
Процедура УправлениеДиалогом()
	Если РасчетЗП_НеУчаствуетВФот Тогда
		Элементы.РасчетЗП_ВидТарифаЗП.Доступность = Ложь;
		Элементы.РасчетЗП_Оклад.Доступность = Ложь;
		Элементы.РасчетЗП_ОкладСумма.Доступность = Ложь;
	Иначе
		Элементы.РасчетЗП_ВидТарифаЗП.Доступность = Истина;
		Элементы.РасчетЗП_Оклад.Доступность = Истина;
		Элементы.РасчетЗП_ОкладСумма.Доступность = Истина;
	КонецеСли;	
	
	ПроверкаАктуальногоБейджа();
КонецПроцедуры	

&НаСервере
Процедура ПроверкаАктуальногоБейджа()
	// проверка наличия актуального бэйджа
	Запрос = Новый Запрос("ВЫБРАТЬ
	|	БэйджиСотрудников.Ссылка КАК Ссылка,
	|	УчетБэйджейСотрудниковСрезПоследних.Сотрудник КАК Сотрудник,
	|	ЕСТЬNULL(УчетБэйджейСотрудниковСрезПоследних.БэйджАктуален, ЛОЖЬ) КАК БэйджАктуален
	|ИЗ
	|	Справочник.БэйджиСотрудников КАК БэйджиСотрудников
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.УчетБэйджейСотрудников.СрезПоследних(, ) КАК УчетБэйджейСотрудниковСрезПоследних
	|		ПО БэйджиСотрудников.Владелец = УчетБэйджейСотрудниковСрезПоследних.Сотрудник
	|ГДЕ
	|	БэйджиСотрудников.Владелец = &Владелец");
	Запрос.УстановитьПараметр("Владелец", Объект.Ссылка);
	Рез = Запрос.Выполнить().Выбрать();
	
	Если Рез.Следующий() Тогда			
		Если Рез.БэйджАктуален Тогда			
			Элементы.ФормаБейджНеАктуален.Доступность = Истина;			
		Иначе
			Элементы.ФормаБейджНеАктуален.Доступность = Ложь;
		КонецЕсли;				
	Иначе
		Элементы.ФормаБейджНеАктуален.Доступность = Ложь;	
	КонецЕсли;	
КонецПроцедуры


&НаКлиенте
Процедура БейджНеАктуален(Команда)
	Бэйдж = ПолучитьБэйджНаСервере(Объект.Ссылка);
	Если Бэйдж <> Неопределено Тогда
		Парам = Новый Структура("Бэйдж", Бэйдж);
		ПоказатьВопрос(Новый ОписаниеОповещения("ПослеОтвета_БэйджНеАктуален", ЭтаФорма, Парам), "Аннулировать бэйдж?", РежимДиалогаВопрос.ДаНет);
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ПослеОтвета_БэйджНеАктуален(Ответ, Парам) Экспорт
	
	Если Ответ = КодВозвратаДиалога.Да Тогда	
		Бэйдж = Парам.Бэйдж;
		Если Бэйдж <> Неопределено Тогда	
			mas.ДеАктуализироватьБэйдж(Бэйдж);	
			Элементы.ФормаБейджНеАктуален.Доступность = Ложь;
		Иначе
			//#Если Клиента Тогда
			//	Сообщить("У сотрудника нет активного бэйджа");
			//#КонецЕсли
		КонецЕсли;
		
	Иначе
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Функция ПолучитьБэйджНаСервере(Владелец) Экспорт
	
	// ищем бэйдж
	Запрос = Новый Запрос("ВЫБРАТЬ
	|	БэйджиСотрудников.Ссылка КАК Ссылка,
	|	УчетБэйджейСотрудниковСрезПервых.Сотрудник КАК Сотрудник,
	|	ЕСТЬNULL(УчетБэйджейСотрудниковСрезПервых.БэйджАктуален, ЛОЖЬ) КАК БэйджАктуален
	|ИЗ
	|	Справочник.БэйджиСотрудников КАК БэйджиСотрудников
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.УчетБэйджейСотрудников.СрезПервых КАК УчетБэйджейСотрудниковСрезПервых
	|		ПО БэйджиСотрудников.Владелец = УчетБэйджейСотрудниковСрезПервых.Сотрудник
	|ГДЕ
	|	БэйджиСотрудников.Владелец = &Владелец");
	Запрос.УстановитьПараметр("Владелец", Владелец);
	Рез = Запрос.Выполнить().Выбрать();
	
	Если Рез.Следующий() Тогда			
		Если Рез.БэйджАктуален Тогда			
			
			Возврат Рез.ссылка;		
		Иначе
			Сообщить("Бэйдж сотрудника более не актуален. ");
			Возврат Неопределено;	
		КонецЕсли;				
	Иначе
		Сообщить("Нет назначенного бейджа. ");
		Возврат Неопределено;	
	КонецЕсли;
	
	
КонецФункции

&НаКлиенте
Процедура НапечататьБейдж(Команда)
	ТабличныйДокумент = Новый ТабличныйДокумент;
	Бэйдж = ПолучитьБэйджНаСервере(Объект.Ссылка);
	
	Если Бэйдж = Неопределено Тогда	
		// вопрос о создании бэйджа
		Парам = Новый Структура("Сотрудник", Объект.Ссылка);
		ТекстВопроса = "Создать и назначить бэйдж на сотрудника " + Объект.Ссылка + "?";
		ПоказатьВопрос(Новый ОписаниеОповещения("СоздатьБэйдж", ЭтаФорма, Парам), ТекстВопроса, РежимДиалогаВопрос.ДаНет);   	
	Иначе
		ТабличныйДокумент = Новый ТабличныйДокумент;
		mas.НапечататьБэйджНаСервере(Бэйдж, ТабличныйДокумент);	
		ТабличныйДокумент.Показать();
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ПослеЗаписи(ПараметрыЗаписи)

	// Вставить содержимое обработчика.
	ЗаписатьДанныеРасчетаЗПИзРСМетодикаРасчетаЗПНаКлиенте();
	
КонецПроцедуры

&НаКлиенте
Процедура СоздатьБэйдж(Парам1, Парам2) Экспорт
	
	Если Парам1 = КодВозвратаДиалога.Да Тогда 
		Бэйдж = mas.СоздатьБэйджСотрудника(Парам2.Сотрудник);	
		Элементы.ФормаБейджНеАктуален.Доступность = Истина;
		
		ТабличныйДокумент = Новый ТабличныйДокумент;
		mas.НапечататьБэйджНаСервере(Бэйдж.Ссылка, ТабличныйДокумент);
		ТабличныйДокумент.Показать();
	Иначе	
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаписатьДанныеРасчетаЗПИзРСМетодикаРасчетаЗПНаКлиенте()
	ЕСли лРасчетЗП_Оклад = РасчетЗП_Оклад И 
		лРасчетЗП_НеУчаствуетВФот = РасчетЗП_НеУчаствуетВФот И
		лРасчетЗП_ОкладСумма = РасчетЗП_ОкладСумма И 
		лРасчетЗП_ВидТарифаЗП = РасчетЗП_ВидТарифаЗП Тогда
		Возврат;
	КонецеСли;	
	ЗаписатьДанныеРасчетаЗПИзРСМетодикаРасчетаЗП();
КонецПроцедуры	

&НаСервере
Процедура ЗаписатьДанныеРасчетаЗПИзРСМетодикаРасчетаЗП()
	
	ТекД = ТекущаяДата();
	
	Наб = РегистрыСведений.МетодикаРасчетаЗППоФизЛицам.СоздатьНаборЗаписей();
	Наб.Отбор.Период.Установить(ТекД);
	Наб.Отбор.ФизЛицо.Установить(Объект.Ссылка);
	
	Нов = Наб.Добавить();
	
	Нов.Период = ТекД;
	Нов.ФизЛицо = Объект.Ссылка;
	Нов.ВидТарифаЗП = РасчетЗП_ВидТарифаЗП;
	Нов.НеУчаствуетВФот = РасчетЗП_НеУчаствуетВФот;
	Нов.ОкладСумма = РасчетЗП_ОкладСумма;
	Нов.Оклад = РасчетЗП_Оклад;
	
	Наб.Записать();
	
КонецПроцедуры	


&НаКлиенте
Процедура МодифицированностьДополнительныхПараметровПриИзменении(Элемент)
	МодифицированностьДопПараметров = Истина;
КонецПроцедуры

//Геннадий 10.06.2020 ->
&НаКлиенте
Процедура НомерЛичногоТелефонаОкончаниеВводаТекста(Элемент, Текст, ДанныеВыбора, ПараметрыПолученияДанных, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
	РаботаСФизЛицамиКлиент.ПроверитьСменуТелефона(Текст, ЭтаФорма);
КонецПроцедуры

&НаКлиенте
Процедура КомментарийФЛОкончаниеВводаТекста(Элемент, Текст, ДанныеВыбора, ПараметрыПолученияДанных, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
	РаботаСФизЛицамиКлиент.ПроверитьСменуКомментария(Текст, ЭтаФорма);
КонецПроцедуры
//Геннадий 10.06.2020 <-

//Асеев 15.02.2023 (Задача № 4985)>>>
&НаКлиенте
Процедура ДокументСерияПриИзменении(Элемент)
	МодифицированностьПаспортныхДанных = Истина;
КонецПроцедуры

&НаКлиенте
Процедура ДокументНомерПриИзменении(Элемент)
	МодифицированностьПаспортныхДанных = Истина;
КонецПроцедуры

&НаКлиенте
Процедура ДокументКемВыданПриИзменении(Элемент)
	МодифицированностьПаспортныхДанных = Истина;
КонецПроцедуры

&НаКлиенте
Процедура ДокументДатаВыдачиПриИзменении(Элемент)
	МодифицированностьПаспортныхДанных = Истина;
КонецПроцедуры

&НаКлиенте
Процедура ДокументКодПодразделенияПриИзменении(Элемент)
	МодифицированностьПаспортныхДанных = Истина;
КонецПроцедуры
//Асеев 15.02.2023 (Задача № 4985)<<<

&НаСервере
Процедура ПриЗаписиНаСервере(Отказ, ТекущийОбъект, ПараметрыЗаписи)
	
	//Асеев 15.02.2023 (Задача № 4985)>>>
	Если МодифицированностьПаспортныхДанных Тогда
		Запрос = Новый Запрос;
		Запрос.Текст =
		"ВЫБРАТЬ
		|	ДокументыУдостоверяющиеЛичность.Ссылка КАК Ссылка
		|ИЗ
		|	Справочник.ДокументыУдостоверяющиеЛичность КАК ДокументыУдостоверяющиеЛичность
		|ГДЕ
		|	ДокументыУдостоверяющиеЛичность.КодИМНС = ""21""";
		
		Выборка = Запрос.Выполнить().Выбрать();
		Если Выборка.Следующий() Тогда
			ЗаписьРегистра = РегистрыСведений.ПаспортныеДанныеФизЛиц.СоздатьМенеджерЗаписи();
			ЗаписьРегистра.Период = ТекущаяДата();
			ЗаписьРегистра.ФизЛицо = ТекущийОбъект.ФизЛицо;
			ЗаписьРегистра.ДокументВид = Выборка.Ссылка;
			ЗаписьРегистра.ДокументСерия = ДокументСерия;
			ЗаписьРегистра.ДокументНомер = ДокументНомер;
			ЗаписьРегистра.ДокументДатаВыдачи = ДокументДатаВыдачи;
			ЗаписьРегистра.ДокументКемВыдан = ДокументКемВыдан;
			ЗаписьРегистра.ДокументКодПодразделения = ДокументКодПодразделения;
			ЗаписьРегистра.Записать();
		КонецЕсли;
	КонецЕсли;
	//Асеев 15.02.2023 (Задача № 4985)<<<
	
КонецПроцедуры



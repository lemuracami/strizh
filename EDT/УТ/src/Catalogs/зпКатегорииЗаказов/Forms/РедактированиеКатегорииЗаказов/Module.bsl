&НаКлиенте
Перем этоНовый;

&НаКлиенте
Процедура ПослеЗаписи(ПараметрыЗаписи)
	
	Если этоНовый Тогда
		ОповеститьОВыборе(Объект.Ссылка);
	Конецесли;

КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	этоНовый = Параметры.Ключ.Пустая();
	СписокДоступныхПоказателей();
	
КонецПроцедуры

&НаСервере
Функция СписокДоступныхПоказателей()
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	зпСхемыКатегорийЗаказовВидыПоказателейКатегорийЗаказов.ВидПоказателяКатегорийЗаказов КАК ВидПоказателяКатегорийЗаказов
		|ИЗ
		|	Справочник.зпСхемыКатегорийЗаказов.ВидыПоказателейКатегорийЗаказов КАК зпСхемыКатегорийЗаказовВидыПоказателейКатегорийЗаказов
		|ГДЕ
		|	зпСхемыКатегорийЗаказовВидыПоказателейКатегорийЗаказов.Ссылка = &Ссылка
		|	И зпСхемыКатегорийЗаказовВидыПоказателейКатегорийЗаказов.ВидПоказателяДоступен";
		//|	И НЕ зпСхемыКатегорийЗаказовВидыПоказателейКатегорийЗаказов.ВидПоказателяКатегорийЗаказов В (&ПоказателиУжеДобавленныеВКатегорию)";
	
	Запрос.УстановитьПараметр("Ссылка", Объект.Владелец);
	//Запрос.УстановитьПараметр("ПоказателиУжеДобавленныеВКатегорию", Объект.ПоказателиКатегории.Выгрузить(,"ВидПоказателя"));
	
	ТаблДоступныхПоказателей = Запрос.Выполнить().Выгрузить();
	Для Каждого показатель Из ТаблДоступныхПоказателей Цикл
		Элементы.ПоказателиКатегорииВидПоказателя.СписокВыбора.Добавить(показатель.ВидПоказателяКатегорийЗаказов);
	КонецЦикла;
	
КонецФункции

&НаКлиенте
Процедура ПоказателиКатегорииВидПоказателяОбработкаВыбора(Элемент, ВыбранноеЗначение, СтандартнаяОбработка)
	
	ПараметрыОтбора = Новый Структура("ВидПоказателя", ВыбранноеЗначение);
	строкаТЧ = Объект.ПоказателиКатегории.НайтиСтроки(ПараметрыОтбора);
	Если строкаТЧ.Количество() > 0 Тогда
		
		СтандартнаяОбработка = Ложь;
		
	Иначе	
		
		Если ВыбранноеЗначение = ПредопределенноеЗначение("Перечисление.зпВидыПоказателейКатегорийЗаказов.ВесЗаказа") ИЛИ 
			ВыбранноеЗначение = ПредопределенноеЗначение("Перечисление.зпВидыПоказателейКатегорийЗаказов.ОбъемЗаказа") Тогда 
			
			Элементы.ПоказателиКатегории.ТекущиеДанные.Значение1 = 0;
			Элементы.ПоказателиКатегории.ТекущиеДанные.Значение2 = 0;
			
		КонецЕсли;	
			
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура ПередЗаписьюНаСервере(Отказ, ТекущийОбъект, ПараметрыЗаписи)
	
	Для Каждого СтрокаПоказателя Из Объект.ПоказателиКатегории Цикл
		ТипЗначения1 = ТипЗнч(СтрокаПоказателя.Значение1);
		ТипЗначения2 = ТипЗнч(СтрокаПоказателя.Значение2);
		Если ТипЗначения1 <> ТипЗначения2 Тогда
			Отказ = Истина;
			Сообщить("Типы значений в строке " + СтрокаПоказателя.НомерСтроки +  " не совпадают: Значение1 - " + ТипЗначения1 + ", Значение2 - " + ТипЗначения2);
		КонецЕсли
	КонецЦикла;
	
КонецПроцедуры

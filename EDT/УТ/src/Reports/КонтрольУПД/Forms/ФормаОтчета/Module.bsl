
&НаКлиенте
Процедура КонтрагентНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
	ПараметрыВыбора = Новый Структура("РежимВыбора",Истина);

	ОткрытьФорму("Справочник.Контрагенты.Форма.ФормаВыбораИМ",ПараметрыВыбора,ЭтаФорма);
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
КонецПроцедуры

&НаКлиенте
Процедура ОбработкаВыбора(ВыбранноеЗначение, ИсточникВыбора)
	Контрагент = ВыбранноеЗначение;
	Результат.Очистить();
КонецПроцедуры

&НаСервере
Процедура СформироватьОтчет()
	ОтчетОбъект = РеквизитФормыВЗначение("Отчет");
	СхемаКомпоновкиДанных = ОтчетОбъект.ПолучитьМакет("ОсновнаяСхемаКомпоновкиДанных");
 	КомпоновщикНастроек = Новый КомпоновщикНастроекКомпоновкиДанных();
	
	Настройки = СхемаКомпоновкиДанных.НастройкиПоУмолчанию;
	
	КомпоновщикНастроек.ЗагрузитьНастройки(Настройки);
	Настройки = КомпоновщикНастроек.ПолучитьНастройки();
	НастройкиОтчета = КомпоновщикНастроек.ПолучитьНастройки();
	КомпоновщикНастроек.Настройки.ПараметрыДанных.Элементы[0].Значение = Контрагент;
	КомпоновщикНастроек.Настройки.ПараметрыДанных.Элементы[3].Значение = Период; 
	НастройкиОтчета.ПараметрыДанных.УстановитьЗначениеПараметра("ВладелецТовара",		Контрагент);	
	НастройкиОтчета.ПараметрыДанных.УстановитьЗначениеПараметра("ПериодОтчета",	Период);
	КомпоновщикНастроек.ЗагрузитьНастройки(НастройкиОтчета);
	КомпоновщикМакета = Новый КомпоновщикМакетаКомпоновкиДанных;
	МакетКомпоновки = КомпоновщикМакета.Выполнить(
	СхемаКомпоновкиДанных,
	КомпоновщикНастроек.Настройки,
	ДанныеРасшифровки);
	
	ПроцессорКомпоновки = Новый ПроцессорКомпоновкиДанных;
	ПроцессорКомпоновки.Инициализировать(МакетКомпоновки, , , Истина);
	
	ПроцессорВывода = Новый ПроцессорВыводаРезультатаКомпоновкиДанныхВТабличныйДокумент;
	Результат.Очистить();
	ПроцессорВывода.УстановитьДокумент(Результат);
	ПроцессорВывода.Вывести(ПроцессорКомпоновки);

КонецПроцедуры

&НаКлиенте
Процедура Сформировать(Команда)
	 СформироватьОтчет();
КонецПроцедуры
